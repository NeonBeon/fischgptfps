local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local lighting = game:GetService("Lighting")
local workspace = game.Workspace
local terrain = workspace.Terrain
local camera = game.Workspace.CurrentCamera

-- Function to remove all other players' characters
local function removeOtherPlayers()
    for _, player in ipairs(players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            player.Character:Destroy()  -- Removes the character
        end
    end
end

-- Function to change avatar to a box
local function changeAvatarToBox(player)
    local character = player.Character
    if character then
        -- Wait for the character to load properly before making changes
        character:WaitForChild("HumanoidRootPart", 10)
        character:WaitForChild("Humanoid", 10)

        -- Remove all existing parts from the character
        for _, part in ipairs(character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part:Destroy()
            end
        end

        -- Create a simple box as the new avatar
        local box = Instance.new("Part")
        box.Size = Vector3.new(2, 5, 2)  -- You can adjust the size as needed
        box.Position = character.HumanoidRootPart.Position
        box.Anchored = false
        box.CanCollide = false
        box.Name = "BoxAvatar"
        box.Parent = character
        
        -- Create a humanoid for the box avatar
        local humanoid = Instance.new("Humanoid")
        humanoid.Parent = character
        humanoid.Health = 100  -- Set a default health value
        
        -- Parent the box to the HumanoidRootPart to ensure it moves with the character
        box.CFrame = character.HumanoidRootPart.CFrame
    end
end

-- Function to modify environment settings (without the grey sky)
local function modifyEnvironment()
    local decalsyeeted = true
    terrain.WaterWaveSize = 0
    terrain.WaterWaveSpeed = 0
    terrain.WaterReflectance = 0
    terrain.WaterTransparency = 1  -- Set water transparency to 1 (effectively hides it)
    lighting.GlobalShadows = false
    lighting.FogEnd = 200  -- Reduce render distance (you can adjust this value)
    lighting.Brightness = 0
    settings().Rendering.QualityLevel = "Level01"

    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
            obj:Destroy()
        elseif obj:IsA("Decal") or obj:IsA("Texture") then
            obj.Transparency = 1  -- Hide decals/textures
        elseif obj:IsA("Part") or obj:IsA("Union") or obj:IsA("CornerWedgePart") or obj:IsA("TrussPart") then
            obj.Material = "Plastic"
            obj.Reflectance = 0
        elseif obj:IsA("Explosion") then
            obj.BlastPressure = 1
            obj.BlastRadius = 1
        elseif obj:IsA("Fire") or obj:IsA("SpotLight") or obj:IsA("Smoke") then
            obj.Enabled = false
        elseif obj:IsA("MeshPart") then
            obj.Material = "Plastic"
            obj.Reflectance = 0
            obj.TextureID = 10385902758728957
        end
    end

    -- Disable visual effects
    for _, effect in pairs(lighting:GetChildren()) do
        if effect:IsA("BlurEffect") or effect:IsA("SunRaysEffect") or effect:IsA("ColorCorrectionEffect") or effect:IsA("BloomEffect") or effect:IsA("DepthOfFieldEffect") then
            effect.Enabled = false
        end
    end
end

-- Initial setup (remove players, modify environment, change avatar)
removeOtherPlayers()
modifyEnvironment()

-- Change local player's avatar to a box
changeAvatarToBox(localPlayer)

-- Connect to PlayerAdded to remove new players when they join
players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        removeOtherPlayers()
        -- Change the new player's avatar to a box
        changeAvatarToBox(player)
    end)
end)

-- Connect to DescendantAdded to handle new objects and particles
workspace.DescendantAdded:Connect(function(obj)
    if obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
        obj:Destroy()
    elseif obj:IsA("Decal") or obj:IsA("Texture") then
        obj.Transparency = 1  -- Hide new decals/textures
    end
end)
